[from-internal]
; Pattern _1XX matches any three-digit number starting with 1
exten => _1XX,1,NoOp(Calling extension ${EXTEN})
exten => _1XX,n,Set(TRANSLATED_NUMBER=${SHELL(allo-wed -config /opt/asterisk/allo-wed.yml -phone ${EXTEN})})
exten => _1XX,n,NoOp(Translated to: ${TRANSLATED_NUMBER})
exten => _1XX,n,GotoIf($["${TRANSLATED_NUMBER}" = ""]?not_allowed)

; Call is allowed and number was translated
exten => _1XX,n,Playback(one-moment-please)
exten => _1XX,n,Dial(PJSIP/${TRANSLATED_NUMBER}@twilio,30)
exten => _1XX,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy)
exten => _1XX,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?noanswer)
exten => _1XX,n,GotoIf($["${DIALSTATUS}" = "UNAVAILABLE"]?unavailable)
exten => _1XX,n,Hangup()

; Call not allowed or no mapping found
exten => _1XX,n(not_allowed),Playback(sorry)
exten => _1XX,n,Playback(nbdy-avail-to-take-call)
exten => _1XX,n,Hangup()

; Busy handling
exten => _1XX,n(busy),Playback(is-curntly-busy)
exten => _1XX,n,Hangup()

; No answer handling
exten => _1XX,n(noanswer),Playback(nbdy-avail-to-take-call)
exten => _1XX,n,Hangup()

; Unavailable handling
exten => _1XX,n(unavailable),Playback(is-curntly-unavail)
exten => _1XX,n,Hangup()

; For debugging purpose
exten = 200,1,Answer()
same = n,Wait(1)
same = n,Playback(en/hello-world)
same = n,Hangup()
